# Лабораторная работа №3. Массивы и Функции

## Цель работы

Освоить работу с массивами в PHP, применяя различные операции: создание, добавление, удаление, сортировка и поиск. Закрепить навыки работы с функциями, включая передачу аргументов, возвращаемые значения и анонимные функции.

## Условие

### Задание 1. Работа с массивами

#### Объявление строгой типизации

```php
declare(strict_types=1);
```

#### Создание массива транзакции

```php
$transactions = [
    [
        "id" => 1,
        "date" => "2019-01-01",
        "amount" => 100.00,
        "description" => "Payment for groceries",
        "merchant" => "SuperMart",
    ],
    [
        "id" => 2,
        "date" => "2020-02-15",
        "amount" => 75.50,
        "description" => "Dinner with friends",
        "merchant" => "Local Restaurant",
    ],
];
```

Создан массив `$transactions`, содержащий список транзакций.

Каждая транзакция представлена ассоциативным массивом с ключами:

- id – уникальный идентификатор.
- date – дата транзакции.
- amount – сумма.
- description – описание назначения.
- merchant – магазин или место покупки.

#### Вывод списка транзакции

```php
function displayTransactions(array $transactions): void {
    echo "<link rel='stylesheet' href='styles.css'>";
    echo "<table>";
    echo "<thead><tr><th>ID</th><th>Дата</th><th>Сумма</th><th>Описание</th><th>Магазин</th><th>Дней с транзакции</th></tr></thead>";
    echo "<tbody>";
    foreach ($transactions as $transaction) {
        $days = daysSinceTransaction($transaction['date']);
        echo "<tr>";
        echo "<td>{$transaction['id']}</td>";
        echo "<td>{$transaction['date']}</td>";
        echo "<td>{$transaction['amount']}</td>";
        echo "<td>{$transaction['description']}</td>";
        echo "<td>{$transaction['merchant']}</td>";
        echo "<td>{$days}</td>";
        echo "</tr>";
    }
    echo "</tbody></table>";
}
```

1. Выводит список транзакций в виде HTML-таблицы.
2. Подключает внешний CSS-файл (styles.css) для стилизации.
3. Использует foreach для перебора массива транзакций.
4. Вызывает daysSinceTransaction(), чтобы вычислить, сколько дней прошло с момента транзакции.

#### Реализация функции

```php
function calculateTotalAmount(array $transactions): float {
    return array_sum(array_column($transactions, 'amount'));
}
```

- Суммирует все значения `amount` и возвращает общую сумму транзакций.
- `array_column($transactions, 'amount')` извлекает все суммы в отдельный массив.
- `array_sum()` вычисляет их сумму.

```php
function findTransactionByDescription(array $transactions, string $descriptionPart): array {
    return array_filter($transactions, fn($t) => strpos(strtolower($t['description']), strtolower($descriptionPart)) !== false);
}
```

- Позволяет искать транзакции по части описания `(descriptionPart)`.
- `array_filter()` фильтрует массив $transactions, оставляя только те, где description содержит искомый текст.
- `strpos()` используется для поиска в строке.
- `strtolower()` приводит строки к нижнему регистру для регистронезависимого поиска.

```php
function daysSinceTransaction(string $date): int {
    $transactionDate = new DateTime($date);
    $now = new DateTime();
    return $now->diff($transactionDate)->days;
}
```

- Принимает дату транзакции `(YYYY-MM-DD)`.
- Создает объект `DateTime` для даты транзакции и текущей даты.
- Вычисляет разницу в днях с помощью `$now->diff($transactionDate)->days`.

```php
usort($transactions, fn($a, $b) => strcmp($b['date'], $a['date']));
```

- `usort()` сортирует массив $transactions по дате.
- Использует `strcmp($b['date'], $a['date'])`, чтобы отсортировать транзакции в порядке убывания (от новых к старым).

#### Вывод таблицы и общей суммы

```php
displayTransactions($transactions);

echo "<br><strong>Общая сумма: " . calculateTotalAmount($transactions) . "</strong>";
```

- Вызывает `displayTransactions($transactions)`, чтобы отобразить таблицу с транзакциями.
- Вычисляет и выводит общую сумму всех транзакций.

### Задание 2. Работа с файловой системой

```php
<?php
            $dir = 'images/';
            $files = scandir($dir);
            if ($files !== false) {
                foreach ($files as $file) {
                    if ($file !== '.' && $file !== '..' && pathinfo($file, PATHINFO_EXTENSION) === 'jpg') {
                        echo "<img src='$dir$file' alt='Cat Image'>";
                    }
                }
            }
            ?>
```

PHP-скрипт автоматически загружает и отображает изображения из папки `images/`. Сначала определяется путь к папке, затем с помощью `scandir()` получается список всех файлов. Проверяется, успешно ли считаны файлы, после чего начинается их перебор в цикле `foreach`. Внутри цикла фильтруются ненужные элементы, такие как служебные записи `.` и `..`, а также файлы, не имеющие расширение `.jpg`. Если файл соответствует условиям, создается HTML-тег `<img>`, который выводит изображение на страницу. В результате этот скрипт динамически формирует галерею, автоматически загружая все подходящие изображения из указанной директории.

### Контрольные вопросы

1. Что такое массивы в PHP?

- Массивы в PHP — это структура данных, которая позволяет хранить несколько значений под одним именем, используя числовые индексы или ассоциативные ключи. Они могут быть одномерными, многомерными и динамически изменяемыми.

2. Каким образом можно создать массив в PHP?

- Массив можно создать с помощью квадратных скобок или функции `array()`, задавая значения либо по порядку, либо в формате ключ-значение. Также можно объявлять многомерные массивы, содержащие вложенные массивы.

3. Для чего используется цикл `foreach`?

- Цикл `foreach` используется для удобного перебора элементов массива без необходимости управлять индексами. Он позволяет работать как с индексными, так и с ассоциативными массивами, автоматически извлекая ключи и значения.

## Вывод

В ходе выполнения лабораторной работы были изучены основные принципы работы с массивами в PHP, включая их создание, модификацию, удаление, сортировку и поиск данных. В рамках задания была разработана система управления банковскими транзакциями, предоставляющая возможность добавления, удаления, сортировки и поиска транзакций. Для реализации функционала использовались различные функции, включая вычисление общей суммы всех транзакций и поиск по заданному описанию. Дополнительно была создана функция, определяющая количество дней, прошедших с момента совершения транзакции.  

Освоение работы с массивами и функциями в PHP способствовало более глубокому пониманию структур данных и их обработки в серверном программировании. Итогом работы стала полноценная система управления транзакциями, которая может быть основой для более сложных проектов, таких как финансовые сервисы или банковские приложения.

## Библиография

- [Официальная документация PHP: Массивы](https://www.php.net/manual/ru/language.types.array.php)
- [Официальная документация PHP: Цикл foreach](https://www.php.net/manual/ru/control-structures.foreach.php)
- [Материалы для работы с массивами, файловыми системами, сортировкой и сравнением](https://www.php.net/manual/ru)
- [Класс DateTime - работа с датами](https://www.php.net/manual/ru/class.datetime.php)