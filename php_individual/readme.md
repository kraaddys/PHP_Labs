# Отчет по индивидуальной работе: Веб-приложение "CarSharing"

## Цель проекта

Целью данной индивидуальной работы является создание полноценной информационной системы по аренде автомобилей — веб-приложения "CarSharing". Проект реализует типичную архитектуру клиент-серверного взаимодействия, где пользователь через браузер обращается к PHP-обработчикам, работающим с базой данных. Основные задачи: регистрация и аутентификация пользователей, бронирование автомобилей, администрирование автопарка и учет аренды. Все формы имеют как клиентскую, так и серверную валидацию, данные фильтруются и защищаются от SQL-инъекций. Работа выполнена строго в процедурном стиле, без применения сторонних библиотек или фреймворков, что способствует глубокому пониманию основ веб-разработки.

---

## Инструкции по запуску проекта

1. Установить локальный сервер XAMPP или аналогичный стек (Apache + MySQL + PHP).
2. Распаковать папку `carsharing-app` в директорию `htdocs`.
3. Открыть phpMyAdmin и создать базу данных `carsharing-app`.
4. Импортировать SQL-дамп `database.sql`, находящийся в корне проекта.
5. Запустить Apache и MySQL.
6. Перейти по адресу `http://localhost/carsharing-app/public/index.php` для начала работы.

---

## Описание структуры проекта и кода

### config/db.php

Файл содержит функцию `db_connect`, предназначенную для подключения к базе данных через PDO. Это единая точка входа для всех запросов к базе данных, что упрощает сопровождение и повышает безопасность. Функция использует локальный хост, имя базы данных `carsharing-app`, стандартного пользователя `root` без пароля и устанавливает кодировку UTF-8.

```php
function db_connect() {
    return new PDO("mysql:host=localhost;dbname=carsharing-app;charset=utf8", "root", "");
}
```

---

### public/register.php

Файл отвечает за регистрацию новых пользователей. Пользователь вводит имя, email, пароль и подтверждение пароля. Далее данные валидируются: проверяется, не пустые ли поля, совпадают ли пароли и не зарегистрирован ли email. Если всё корректно — пароль хешируется с помощью `password_hash`, а затем данные записываются в таблицу `users`. При успешной регистрации создается сессия пользователя, и он перенаправляется в `dashboard.php`.

```php
$hashed = password_hash($password, PASSWORD_DEFAULT);
$stmt = $pdo->prepare("INSERT INTO users (name, email, password, role) VALUES (?, ?, ?, 'user')");
$stmt->execute([$name, $email, $hashed]);
```

---

### public/login.php

Файл `login.php` обрабатывает авторизацию. Сначала производится поиск пользователя по введенному email, затем проверка пароля с помощью `password_verify`. Если всё верно, то создается сессия с данными пользователя и его ролью. В противном случае отображается сообщение об ошибке. Это ключевая часть защиты всех защищённых страниц.

```php
if ($user && password_verify($password, $user['password'])) {
    $_SESSION['user_id'] = $user['id'];
    $_SESSION['name'] = $user['name'];
    $_SESSION['role'] = $user['role'];
    header("Location: dashboard.php");
    exit;
}
```

---

### public/dashboard.php

Это страница личного кабинета пользователя. В зависимости от его роли отображаются разные ссылки. Обычный пользователь может бронировать авто, а администратор получает доступ к управлению автомобилями и пользователями. Страница формируется динамически, основываясь на переменной `$_SESSION['role']`, и включает простую навигацию и приветствие по имени пользователя.

---

### public/index.php

Главная страница приложения. Она доступна всем пользователям, включая незарегистрированных. На странице отображаются только доступные для бронирования автомобили. Каждый автомобиль выводится в виде карточки с фото, ценой, местоположением и кнопкой "Забронировать". Данные берутся из таблицы `cars`, фильтрация осуществляется по статусу `available`.

```php
$stmt = $pdo->prepare("SELECT * FROM cars WHERE status = 'available'");
$stmt->execute();
$cars = $stmt->fetchAll(PDO::FETCH_ASSOC);
```

---

### public/select\_car.php и book.php

Файл `select_car.php` выводит список доступных авто, а `book.php` позволяет оформить аренду. Пользователь выбирает авто, указывает дату начала и окончания аренды. После валидации данных в `book.php` происходит запись в таблицу `bookings`, а статус авто меняется на `booked`. Также в `my_bookings.php` реализовано автоматическое освобождение машины после окончания срока аренды.

```php
$stmt = $pdo->prepare("INSERT INTO bookings (user_id, car_id, start_time, end_time) VALUES (?, ?, ?, ?)");
$stmt->execute([$user_id, $car_id, $start, $end]);
```

---

### public/my\_bookings.php

Страница отображает активные аренды текущего пользователя. Также предоставляет возможность завершить аренду раньше срока. При завершении аренды статус автомобиля меняется обратно на `available`, а запись в таблице `bookings` удаляется. Отображение реализовано в виде карточек, повторяющих стиль главной страницы.

---

### public/search.php

Файл `search.php` предоставляет форму поиска автомобилей. Фильтрация осуществляется по части названия модели, локации и статусу. Запрос строится динамически и безопасно: используется `prepare` и `execute`, чтобы избежать SQL-инъекций. Отображение результатов аналогично `index.php`, но с дополнительными параметрами фильтра.

---

### public/forgot\_password.php и reset\_password.php

Эти два файла реализуют механизм восстановления пароля. В `forgot_password.php` пользователь вводит email, ему отправляется ссылка с токеном. В `reset_password.php` по этому токену открывается форма ввода нового пароля. После ввода новый пароль сохраняется в хешированном виде, и пользователь может снова войти в систему.

---

### admin/cars.php, add\_car.php, edit\_car.php, delete\_car.php

Данные файлы реализуют панель администратора. В `cars.php` отображается список всех автомобилей. `add_car.php` позволяет добавить новый автомобиль, включая загрузку изображения. `edit_car.php` — редактировать данные автомобиля. `delete_car.php` — удалить запись из таблицы. Все формы валидируются и защищены. Работа с изображениями осуществляется с проверкой типа и безопасным сохранением в папку `uploads/`.

---

## Структура базы данных

1. **users** — `id`, `name`, `email`, `password`, `role`
2. **cars** — `id`, `model`, `number_plate`, `location`, `price_per_hour`, `status`, `photo`
3. **bookings** — `id`, `user_id`, `car_id`, `start_time`, `end_time`
4. **password\_resets** — `id`, `email`, `token`, `created_at`

---

## Ответы на контрольные вопросы

1. **Как реализована безопасность хранения паролей?**
   Используется `password_hash` при регистрации и `password_verify` при входе, что гарантирует безопасность хранения паролей и их защиту от атак.

2. **Как реализована форма с валидацией?**
   Все формы используют HTML5-валидацию (`required`, `type="email"`, `min`, `max`) и серверную валидацию через `empty()`, `filter_var()` и проверку длины/диапазонов.

3. **Какие меры защиты от SQL-инъекций?**
   Абсолютно все запросы к базе реализованы через `prepare()` и `execute()` — никаких прямых вставок переменных в SQL нет.

4. **Как обеспечена защита от несанкционированного доступа?**
   Все защищённые страницы проверяют наличие `$_SESSION['user_id']`. Панель администратора проверяет также `$_SESSION['role'] === 'admin'`.

5. **Какие существуют роли пользователей?**
   Две роли — `user` и `admin`. Первая имеет доступ к бронированию и просмотру аренды, вторая — ко всем административным действиям и управлению пользователями.

6. **Как происходит взаимодействие пользователя с приложением?**
   Пользователь регистрируется, входит в систему, выбирает машину, бронирует её, просматривает или завершает аренду. Администратор управляет автопарком.

---

## Вывод

Проект представляет собой полноценную систему для онлайн-аренды автомобилей. Он охватывает все этапы: регистрацию, вход, бронирование, просмотр и управление. Для администратора реализован интерфейс управления автопарком. Использование PDO, сессий и хеширования обеспечивает высокую безопасность. Приложение написано в модульной структуре, что упрощает его поддержку и масштабирование. Все требования индивидуального задания были соблюдены, включая документацию, безопасную архитектуру и формы взаимодействия с пользователем.

---

## Библиография

1. **PHP.NET Manual** — документация PHP, описание функций `session_start`, `password_hash`, `htmlspecialchars` и др.
   [https://www.php.net/manual/en/](https://www.php.net/manual/en/) — основной источник по синтаксису и возможностям PHP.

2. **W3Schools PHP Tutorials** — справочник по PHP и MySQL, формы и методы взаимодействия.
   [https://www.w3schools.com/php/](https://www.w3schools.com/php/) — использован для базовых конструкций, форм, работы с PDO.

3. **MDN SQL Injection Guide** — руководство по безопасной работе с SQL, валидации и защите от инъекций.
   [https://developer.mozilla.org/en-US/docs/Learn/Server-side/SQL\_injection](https://developer.mozilla.org/en-US/docs/Learn/Server-side/SQL_injection) — источник по безопасным SQL-запросам.

4. **Stack Overflow** — сообщество, используемое для поиска решений возникающих проблем.
   [https://stackoverflow.com](https://stackoverflow.com) — поддержка по синтаксису, ошибкам и архитектурным решениям.

5. **Learn X in Y Minutes (PHP)** — краткий справочник по основам PHP.
   [https://learnxinyminutes.com/docs/php/](https://learnxinyminutes.com/docs/php/) — для быстрого освежения синтаксиса и конструкции языка.
